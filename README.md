# uber_highload

## 1. Целевая аудитория
- 91 млн. активных пользователей
- 4 млн. водителей-партнеров
- 14 млн. поездок ежедневно
- Основная аудитория сервиса находится в северной Америке и Европе

## 2. Расчет нагрузки

В городе Нью-Йорке, где очень много пользуются такси, в начале 2020 года, в день совершалось около 520к поездок, при 69к водителей на линии https://www.businessofapps.com/data/uber-statistics/. Возьмем эту статистику и рассчитаем, сколько примерно водителей на линии в мире одновременно:
**14 000к / 520к * 69к = 1 858к**

Водители будут каждые 3 секунды отсылать свои координаты.
1 858 000 / 3 = 619 334 rps.
Водитель посылает свой id (4 байта), широту (8 байт), долготу (8 байт).
Каждый 3 секунды, водители будут присылать 36Мб данных о своем местоположении. В день будет перадавься 1Тб данных с местоположением водителей.
Для экономии трафика водителей данные будем передавать по UDP, т.к. данные не критичны и мы можем их терять.

Расчитаем пиковую нагрузку, которую создают клиенты. 14 000 000 / 86 400 * 3 = 486 rps.
На запрос пользователя, будем выдавать максимум 5 ближайших машин.

Для работы с геологацией выбирем библиотеку Google S2. При помощи нее мы можем разделить Землю на ячейки с уникальными идентификаторами. Имея широту и долготу, мы можем узнать в какой ячейке находится водитель или клиент.

## 3. Логическая схема базы данных
![Снимок экрана 2021-05-19 в 20 58 38](https://user-images.githubusercontent.com/43621139/118861431-299b5780-b8e5-11eb-8a5a-9293cc32356d.png)

## 4. Физическая схема базы данных
- для хранения геолокации водителей будем использовать Tarantool
- для всех остальных данных MySQL
- для кеширования данных о водителях будем использовать Redis
![физическая](https://user-images.githubusercontent.com/43621139/119151711-5328c000-ba58-11eb-982a-4581408805e9.png)


## 5. Выбор технологий
В качестве языка для backend разработки выберем Go. Это компилируемый, статически типизуермый язык. Он достаточно производительный и потребляет адекватное количество ресурсов. Он прост в изучении, что позволит нанимать программистов с опытом работы на других языках. Упор будем делать на мобильные приложения, поэтому для их разработки выберем языки Swift и Kotlin. Для организации очередей будем использовать kafka.

## 6. Схема проекта
![Снимок экрана 2021-05-19 в 20 26 45](https://user-images.githubusercontent.com/43621139/119163129-c97eef80-ba63-11eb-885a-44955542233e.png)

